# 図書館管理システム セキュリティ設計書

## 1. 概要

本セキュリティ設計書は、図書館管理システムにおけるセキュリティ要件を満たすための具体的な設計と対策について記述します。ユーザーの認証・認可、パスワード管理、データ保護、セッション管理、ログ管理、不正ログイン防止など、システムの安全性を確保するための対策を明示します。

---

## 2. セキュリティ要件

### 2.1 認証と認可
- **認証**: 
  - Spring Securityを使用してユーザーの認証を行います。認証には、ユーザーが登録したメールアドレスとパスワードを用います。
- **認可**:
  - 認証済みユーザーに対して、一般ユーザーと管理者で異なる権限を付与します。  
    - **一般ユーザー**: 書籍検索、貸出、返却、予約の機能にアクセス可能
    - **管理者**: 貸出状況の確認、ユーザー管理、返却処理にアクセス可能

### 2.2 パスワード管理
- **暗号化**:
  - パスワードはBCryptアルゴリズムを用いて暗号化し、データベースに保存します。
- **パスワード強度**:
  - パスワードは8文字以上で、英数字および特殊文字の組み合わせを推奨します。
- **多要素認証（MFA）**:
  - Google Authenticatorを使用したワンタイムパスワード（OTP）による二段階認証を導入し、セキュリティを強化します。

### 2.3 セッション管理
- **セッションタイムアウト**:
  - 一定時間（例：30分）操作がない場合、自動的にログアウトさせます。
- **同時ログインの制御**:
  - 1ユーザーにつき、同時に1つのセッションのみを許可し、新しいセッションが開始されると以前のセッションを無効化します。
- **トークン管理**:
  - セッションの識別と管理には、セキュリティトークンを使用します。トークンの無効化が発生した場合、新たなログインが必要です。

---

## 3. データ保護

### 3.1 データベース保護
- **SQLインジェクション対策**:
  - ユーザー入力を適切にバリデーションし、プリペアドステートメントを使用してSQLインジェクションを防止します。
- **XSS（クロスサイトスクリプティング）対策**:
  - 画面に出力するデータはすべてサニタイズ処理を行い、ユーザー入力によるスクリプト実行を防ぎます。
- **アクセス制限**:
  - 特定のエンドポイントやリソースには認可が必要なように設定し、不正アクセスを制限します。

### 3.2 IPアドレスの記録と不正アクセス検出
- **IPアドレスの記録**:
  - 各ログイン時にユーザーのIPアドレスを記録し、不正なログイン試行を監視します。
- **不正ログイン対策**:
  - 一定回数（例：5回）以上のログイン失敗が発生した場合、アカウントを一時ロックし、ユーザーに通知します。
  - 不正なIPアドレスからのアクセスが連続した場合、そのIPアドレスをブロックする措置を検討します。

---

## 4. ログ管理

### 4.1 操作ログ
- **記録対象**:
  - ユーザーのログイン・ログアウト、貸出・返却、アカウント作成などの重要な操作を記録します。
- **アクセス制御**:
  - 操作ログへのアクセスは管理者のみが行えるように制御します。

### 4.2 監査ログ
- **内容**:
  - システム内部でのエラーメッセージや不正アクセスの試行、システムに対する変更操作などを記録します。
- **アラート機能**:
  - 不正なアクセスや連続するエラーログなどが検出された場合、自動的に管理者に通知するアラート機能を導入します。

---

## 5. エラーハンドリングとフィードバック

### 5.1 エラーメッセージの表示
- ユーザーにエラーメッセージを表示する際、内部システム構造を露呈しないように配慮します。例：「無効なユーザー名またはパスワード」など、一般的なメッセージを使用。

### 5.2 フィードバックの提供
- 入力ミスやバリデーションエラーについては、即時にユーザーにフィードバックし、修正を促します。

---

以上が図書館管理システムのセキュリティ設計書です。これらの対策により、システムの安全性を確保し、ユーザーと管理者のデータを保護することを目的としています。
