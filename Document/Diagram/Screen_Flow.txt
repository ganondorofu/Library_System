stateDiagram-v2
    [*] --> ログイン画面
    
    state ログイン関連 {
        ログイン画面 --> アカウント作成画面: アカウント作成リンク
        アカウント作成画面 --> ログイン画面: 作成完了/キャンセル
        ログイン画面 --> パスワードリセット画面: パスワード忘れリンク
        パスワードリセット画面 --> ログイン画面: リセット完了/キャンセル
        ログイン画面 --> 多要素認証画面: ログイン成功
        多要素認証画面 --> メイン画面: 認証成功
    }

    state 一般利用者機能 {
        メイン画面 --> 書籍検索画面: 書籍検索
        書籍検索画面 --> 書籍詳細画面: 書籍選択
        書籍詳細画面 --> 貸出確認画面: 貸出ボタン
        書籍詳細画面 --> 予約確認画面: 予約ボタン
        貸出確認画面 --> 貸出完了画面: 確認
        予約確認画面 --> 予約完了画面: 確認
    }

    state 利用者メニュー {
        メイン画面 --> 貸出履歴画面: 貸出履歴
        メイン画面 --> 予約状況画面: 予約確認
        メイン画面 --> プロフィール設定画面: プロフィール
        プロフィール設定画面 --> MFA設定画面: MFA設定
    }

    state 管理者機能 {
        state 管理者メイン画面 {
            [*] --> ダッシュボード
        }
        メイン画面 --> 管理者メイン画面: 管理者権限
        管理者メイン画面 --> ユーザー管理画面: ユーザー管理
        管理者メイン画面 --> 貸出管理画面: 貸出管理
        管理者メイン画面 --> 予約管理画面: 予約管理
        管理者メイン画面 --> 書籍管理画面: 書籍管理
        管理者メイン画面 --> システムログ画面: ログ確認
        
        state ユーザー管理画面 {
            [*] --> ユーザー一覧
            ユーザー一覧 --> ユーザー詳細
            ユーザー詳細 --> ユーザー編集
        }
        
        state 書籍管理画面 {
            [*] --> 書籍一覧
            書籍一覧 --> 書籍編集
            書籍一覧 --> 新規書籍登録
            書籍一覧 --> 書籍削除確認
            書籍削除確認 --> 書籍一覧: 削除完了/キャンセル
        }

        state 貸出管理画面 {
            [*] --> 貸出一覧
            貸出一覧 --> 返却処理
            返却処理 --> 返却完了
            返却完了 --> 貸出一覧
        }
    }

    メイン画面 --> ログイン画面: ログアウト
    管理者メイン画面 --> ログイン画面: ログアウト